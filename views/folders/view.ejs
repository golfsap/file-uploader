<h1>/<%= folder.name %></h1>

<!-- Share section -->
<div class="share-section">
  <h2>Share this folder</h2>
  <form action="" id="shareForm" style="margin-bottom: 15px">
    <label for="duration">Link expires in:</label>
    <select name="duration" id="duration" style="margin: 0 10px">
      <option value="1">1 hour</option>
      <option value="24">24 hours</option>
      <option value="168">7 days</option>
      <option value="720">30 days</option>
    </select>
    <button type="submit">Generate Link</button>
  </form>

  <div
    id="shareResult"
    style="
      display: none;
      background: #f0f0f0;
      padding: 10px;
      border-radius: 3px;
    "
  >
    <p><strong>Share this link:</strong></p>
    <div style="display: flex; gap: 10px; margin: 10px 0">
      <input type="text" id="shareUrl" readonly style="flex: 1; padding: 5px" />
      <button onclick="copyToClipboard()">Copy Link</button>
    </div>
    <p style="font-size: 0.9em; color: #666">
      Expires: <span id="expiresAt"></span>
    </p>
  </div>

  <!-- Active Share Links -->
  <div id="activeShares" style="margin-top: 15px">
    <h3>Active Share Links</h3>
    <ul id="sharesList"></ul>
  </div>
</div>

<!-- upload Section -->
<h2>Upload a file</h2>
<form
  action="/files/upload/<%= folder.id %>"
  method="post"
  enctype="multipart/form-data"
>
  <input type="file" name="file" required />
  <button type="submit">Upload</button>
</form>

<h2>Files:</h2>
<ul>
  <% files.forEach(file => { %>
  <li>
    <a href="/files/<%= file.id %>"><%= file.name %></a>
    <button
      class="delete-btn"
      onclick="deleteFile(<%= file.id %>, <%= folder.id %>)"
    >
      Delete
    </button>
  </li>
  <% }) %>
</ul>
<a href="/folders">Back to all folders</a>

<script>
  document.getElementById('shareForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const duration = document.getElementById('duration').value;
    const folderId = <%= folder.id %>;

    try {
      const response = await fetch(`/folders/${folderId}/share`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ duration }),
      });

      const data = await response.json();

      if (data.success) {
        document.getElementById('shareUrl').value = data.shareUrl;
      document.getElementById('expiresAt').textContent = new Date(data.expiresAt).toLocaleString();
      document.getElementById('shareResult').style.display = 'block';
      }
    } catch (err) {
      alert('Error creating share link');
    }
  });

  function copyToClipboard() {
    const shareUrl = document.getElementById('shareUrl');
    shareUrl.select();
    shareUrl.setSelectionRange(0, 99999); // For mobile devices

    navigator.clipboard.writeText(shareUrl.value).then(() => {
      alert('Link copied to clipboard!');
    }).catch(() => {
      document.execCommand('copy');
      alert('Link copied to slipboard!');
    });
  }
</script>
